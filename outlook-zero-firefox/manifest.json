{
  "manifest_version": 2,
  "name": "Outlook Web Keyboard Shortcuts",
  "description": "Add customizable keyboard shortcuts to Outlook on the web, starting with an undo-archive shortcut.",
  "version": "0.1.0",
  "permissions": [
    "storage",
    "https://outlook.live.com/*",
    "https://outlook.office.com/*",
    "https://outlook.office365.com/*"
  ],
  "content_scripts": [
    {
      "matches": [
        "https://outlook.live.com/*",
        "https://outlook.office.com/*",
        "https://outlook.office365.com/*"
      ],
      "js": [
        "contentScript.js"
      ],
      "run_at": "document_idle"
    }
  ],
  "background": {
    "scripts": [
      "background.js"
    ],
    "persistent": false
  },
  "browser_action": {
    "default_title": "Outlook Web Keyboard Shortcuts"
  },
  "options_ui": {
    "page": "options.html",
    "open_in_tab": true
  }
}

*** Add File: /Users/lcolvin/Dev/outlook-zero-firefox/background.js
// Background script for Outlook Web Keyboard Shortcuts (Firefox/Manifest V2)
// Clicking the toolbar icon opens the options page in a full tab.

(() => {
  const api = typeof chrome !== "undefined" ? chrome : browser;

  const clickEventSource =
    (api && api.browserAction && api.browserAction.onClicked) ||
    (api && api.action && api.action.onClicked);

  if (clickEventSource) {
    clickEventSource.addListener(() => {
      try {
        if (api.runtime && api.runtime.openOptionsPage) {
          api.runtime.openOptionsPage();
        }
      } catch (e) {
        // best-effort only
      }
    });
  }
})();

*** Add File: /Users/lcolvin/Dev/outlook-zero-firefox/contentScript.js
// Outlook Web Keyboard Shortcuts - Content Script (Firefox build)
// Listens for a configurable keyboard shortcut, vim-style navigation, and clicks the "Undo" button.

(() => {
  const browserApi = typeof chrome !== "undefined" ? chrome : browser;

  const DEFAULT_UNDO_SHORTCUT = {
    ctrlKey: true,
    altKey: false,
    shiftKey: false,
    metaKey: false,
    key: "z" // normalized to lower-case
  };

  let undoShortcut = { ...DEFAULT_UNDO_SHORTCUT };
  let vimEnabled = true;

  function loadSettings() {
    try {
      browserApi.storage.sync.get(
        { undoShortcut: DEFAULT_UNDO_SHORTCUT, vimEnabled: true },
        (items) => {
          if (browserApi.runtime && browserApi.runtime.lastError) {
            // Fail silently; use defaults
            return;
          }
          if (items) {
            if (items.undoShortcut) {
              undoShortcut = {
                ...DEFAULT_UNDO_SHORTCUT,
                ...items.undoShortcut
              };
            }
            if (typeof items.vimEnabled === "boolean") {
              vimEnabled = items.vimEnabled;
            }
          }
        }
      );
    } catch (e) {
      // Fallback to defaults if storage is not available
      undoShortcut = { ...DEFAULT_UNDO_SHORTCUT };
      vimEnabled = true;
    }
  }

  function isEditableElement(target) {
    if (!target) return false;
    const tag = target.tagName ? target.tagName.toLowerCase() : "";
    if (tag === "input" || tag === "textarea" || tag === "select") return true;
    if (target.isContentEditable) return true;
    return false;
  }

  function shortcutMatches(event, shortcut) {
    const key = (event.key || "").toLowerCase();
    return (
      !!shortcut &&
      !!key &&
      key === (shortcut.key || "").toLowerCase() &&
      !!event.ctrlKey === !!shortcut.ctrlKey &&
      !!event.shiftKey === !!shortcut.shiftKey &&
      !!event.altKey === !!shortcut.altKey &&
      !!event.metaKey === !!shortcut.metaKey
    );
  }

  function findUndoButton() {
    // Outlook Web typically uses an "Undo" button with an aria-label or title of "Undo"
    const selectors = [
      'button[aria-label="Undo"]',
      'button[title="Undo"]',
      'button[aria-label*="Undo"]',
      'button[title*="Undo"]'
    ];

    for (const selector of selectors) {
      const btn = document.querySelector(selector);
      if (btn) return btn;
    }

    // Fallback: search by text content (less efficient but more robust)
    const buttons = Array.from(document.querySelectorAll("button"));
    return buttons.find((btn) => {
      const text = (btn.textContent || "").trim().toLowerCase();
      return text === "undo";
    });
  }

  function triggerUndo() {
    const button = findUndoButton();
    if (!button) {
      return;
    }
    button.click();
  }

  function getMessageRows() {
    // Outlook's message list is typically rendered as a grid or listbox of rows/options
    const container =
      document.querySelector('[role="grid"]') ||
      document.querySelector('[role="listbox"]') ||
      document.querySelector('[role="treegrid"]');
    if (!container) return [];
    return Array.from(
      container.querySelectorAll('[role="row"], [role="option"]')
    );
  }

  function getCurrentRowIndex(rows) {
    if (!rows || !rows.length) return -1;
    const active = document.activeElement;
    let fallbackIndex = -1;

    for (let i = 0; i < rows.length; i += 1) {
      const row = rows[i];
      if (!row) continue;
      const el = /** @type {HTMLElement} */ (row);

      // Selected via ARIA
      if (el.getAttribute("aria-selected") === "true") {
        return i;
      }

      // Selected via data attribute (common in React grids)
      if (el.getAttribute("data-is-selected") === "true") {
        fallbackIndex = i;
      }

      // Selected via CSS class
      if (el.classList && (el.classList.contains("is-selected") || el.classList.contains("selected"))) {
        fallbackIndex = i;
      }

      // Focused element is inside this row
      if (active && el.contains(active)) {
        fallbackIndex = i;
      }
    }

    return fallbackIndex;
  }

  function moveSelection(direction) {
    const rows = getMessageRows();
    if (!rows.length) return;

    let index = getCurrentRowIndex(rows);
    if (index === -1) {
      index = direction === "down" ? 0 : rows.length - 1;
    } else if (direction === "down") {
      index = Math.min(rows.length - 1, index + 1);
    } else {
      index = Math.max(0, index - 1);
    }

    const targetRow = /** @type {HTMLElement} */ (rows[index]);
    if (!targetRow) return;

    targetRow.click();
    if (typeof targetRow.focus === "function") {
      targetRow.focus();
    }
    if (typeof targetRow.scrollIntoView === "function") {
      targetRow.scrollIntoView({ block: "nearest" });
    }
  }

  function onKeyDown(event) {
    try {
      // Ignore if user is typing in an input/textarea/contentEditable
      if (isEditableElement(event.target)) {
        return;
      }

      const key = (event.key || "").toLowerCase();

      // Vim-style navigation: j = down, k = up (no modifiers)
      if (
        vimEnabled &&
        !event.ctrlKey &&
        !event.altKey &&
        !event.shiftKey &&
        !event.metaKey
      ) {
        if (key === "j") {
          event.preventDefault();
          event.stopPropagation();
          moveSelection("down");
          return;
        }
        if (key === "k") {
          event.preventDefault();
          event.stopPropagation();
          moveSelection("up");
          return;
        }
      }

      if (undoShortcut && shortcutMatches(event, undoShortcut)) {
        event.preventDefault();
        event.stopPropagation();
        triggerUndo();
      }
    } catch (e) {
      // Never let errors break the page
      // eslint-disable-next-line no-console
      console.debug("Outlook Keyboard Shortcuts content script error:", e);
    }
  }

  // Initial load
  loadSettings();

  // Listen for settings changes from the options page
  try {
    browserApi.storage.onChanged.addListener((changes, areaName) => {
      if (areaName !== "sync") return;
      if (changes.undoShortcut && changes.undoShortcut.newValue) {
        undoShortcut = {
          ...DEFAULT_UNDO_SHORTCUT,
          ...changes.undoShortcut.newValue
        };
      }
      if (changes.vimEnabled && typeof changes.vimEnabled.newValue === "boolean") {
        vimEnabled = changes.vimEnabled.newValue;
      }
    });
  } catch (e) {
    // Ignore if storage events are not available
  }

  window.addEventListener("keydown", onKeyDown, true);
})();

*** Add File: /Users/lcolvin/Dev/outlook-zero-firefox/options.html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Outlook Web Keyboard Shortcuts – Settings</title>
    <link rel="stylesheet" href="options.css" />
  </head>
  <body>
    <main class="oz-container">
      <header class="oz-header">
        <div class="oz-icon-circle">
          <span class="oz-icon-letter">OZ</span>
        </div>
        <div>
          <h1>Outlook Web Keyboard Shortcuts</h1>
          <p class="oz-subtitle">
            Customize keyboard shortcuts for Outlook on the web. Start by setting a shortcut for
            <strong>Undo archive</strong>.
          </p>
        </div>
      </header>

      <section class="oz-card">
        <h2>Undo Archive Shortcut</h2>
        <p class="oz-help">
          Click in the box below, then press the key combination you want to use (for example
          <kbd>Ctrl</kbd> + <kbd>Z</kbd> or <kbd>Alt</kbd> + <kbd>U</kbd>).
        </p>

        <div class="oz-shortcut-row">
          <label for="undoShortcut" class="oz-label">Shortcut</label>
          <input
            id="undoShortcut"
            type="text"
            class="oz-shortcut-input"
            autocomplete="off"
            spellcheck="false"
            placeholder="Press keys…"
          />
          <button id="clearUndo" class="oz-button oz-button-ghost" type="button">Clear</button>
        </div>

        <label class="oz-toggle">
          <input id="vimEnabled" type="checkbox" class="oz-toggle-input" />
          <span class="oz-toggle-label">
            Enable vim-style navigation with <kbd>j</kbd> / <kbd>k</kbd> in the message list
          </span>
        </label>

        <p id="status" class="oz-status" role="status" aria-live="polite"></p>
      </section>

      <section class="oz-card">
        <h2>How it works</h2>
        <ul class="oz-list">
          <li>
            <strong>Where it runs</strong>: Only on Outlook web pages
            (<code>outlook.live.com</code>, <code>outlook.office.com</code>, <code>outlook.office365.com</code>).
          </li>
          <li>
            <strong>What it does</strong>: Listens for your shortcut and clicks the
            <em>Undo</em> button that appears after you archive or move an email.
          </li>
          <li>
            <strong>Typing safety</strong>: Shortcuts are ignored while you are typing in an input, text area, or
            editable field so they do not interfere with composing emails.
          </li>
        </ul>
      </section>

      <footer class="oz-footer">
        <span>Version 0.1.0</span>
        <span>Made for Firefox · Outlook Zero</span>
      </footer>
    </main>

    <script src="options.js"></script>
  </body>
</html>

*** Add File: /Users/lcolvin/Dev/outlook-zero-firefox/options.js
// Outlook Web Keyboard Shortcuts - Options Page (Firefox build)

(() => {
  const browserApi = typeof chrome !== "undefined" ? chrome : browser;

  const DEFAULT_UNDO_SHORTCUT = {
    ctrlKey: true,
    altKey: false,
    shiftKey: false,
    metaKey: false,
    key: "z"
  };

  const shortcutInput = document.getElementById("undoShortcut");
  const statusEl = document.getElementById("status");
  const clearBtn = document.getElementById("clearUndo");
  const vimToggle = document.getElementById("vimEnabled");

  function formatShortcut(shortcut) {
    if (!shortcut || !shortcut.key) return "Not set";

    const parts = [];
    if (shortcut.ctrlKey) parts.push("Ctrl");
    if (shortcut.altKey) parts.push("Alt");
    if (shortcut.shiftKey) parts.push("Shift");
    if (shortcut.metaKey) parts.push(navigator.platform.includes("Mac") ? "Cmd" : "Meta");
    parts.push(shortcut.key.toUpperCase());

    return parts.join(" + ");
  }

  function setStatus(message) {
    if (!statusEl) return;
    statusEl.textContent = message;
    statusEl.classList.add("oz-status-visible");
    setTimeout(() => {
      statusEl.classList.remove("oz-status-visible");
    }, 2000);
  }

  function saveShortcut(shortcut) {
    try {
      browserApi.storage.sync.set({ undoShortcut: shortcut }, () => {
        if (browserApi.runtime && browserApi.runtime.lastError) {
          setStatus("Could not save shortcut (storage error).");
          return;
        }
        shortcutInput.value = formatShortcut(shortcut);
        setStatus("Shortcut saved.");
      });
    } catch (e) {
      setStatus("Could not save shortcut.");
    }
  }

  function saveVimEnabled(enabled) {
    try {
      browserApi.storage.sync.set({ vimEnabled: enabled }, () => {
        if (browserApi.runtime && browserApi.runtime.lastError) {
          setStatus("Could not update vim setting (storage error).");
          return;
        }
        setStatus(enabled ? "Vim navigation enabled." : "Vim navigation disabled.");
      });
    } catch (e) {
      setStatus("Could not update vim setting.");
    }
  }

  function handleKeyCapture(event) {
    event.preventDefault();
    event.stopPropagation();

    const key = (event.key || "").toLowerCase();

    // Ignore keys that are just modifiers or not useful
    const ignoredKeys = [
      "shift",
      "control",
      "alt",
      "meta",
      "capslock",
      "tab"
    ];
    if (!key || ignoredKeys.includes(key)) {
      return;
    }

    const shortcut = {
      ctrlKey: event.ctrlKey,
      altKey: event.altKey,
      shiftKey: event.shiftKey,
      metaKey: event.metaKey,
      key
    };

    saveShortcut(shortcut);
  }

  function restoreOptions() {
    try {
      browserApi.storage.sync.get(
        { undoShortcut: DEFAULT_UNDO_SHORTCUT, vimEnabled: true },
        (items) => {
          if (browserApi.runtime && browserApi.runtime.lastError) {
            shortcutInput.value = formatShortcut(DEFAULT_UNDO_SHORTCUT);
            return;
          }
          const shortcut = (items && items.undoShortcut) || DEFAULT_UNDO_SHORTCUT;
          shortcutInput.value = formatShortcut(shortcut);

          if (vimToggle) {
            const enabled =
              items && typeof items.vimEnabled === "boolean"
                ? items.vimEnabled
                : true;
            vimToggle.checked = enabled;
          }
        }
      );
    } catch (e) {
      shortcutInput.value = formatShortcut(DEFAULT_UNDO_SHORTCUT);
      if (vimToggle) {
        vimToggle.checked = true;
      }
    }
  }

  function clearShortcut() {
    const emptyShortcut = {
      ctrlKey: false,
      altKey: false,
      shiftKey: false,
      metaKey: false,
      key: ""
    };
    saveShortcut(emptyShortcut);
  }

  if (shortcutInput) {
    shortcutInput.addEventListener("keydown", handleKeyCapture);
    shortcutInput.addEventListener("keyup", (e) => {
      e.preventDefault();
      e.stopPropagation();
    });
  }

  if (clearBtn) {
    clearBtn.addEventListener("click", clearShortcut);
  }

  if (vimToggle) {
    vimToggle.addEventListener("change", (e) => {
      const target = /** @type {HTMLInputElement} */ (e.target);
      saveVimEnabled(!!target.checked);
    });
  }

  document.addEventListener("DOMContentLoaded", restoreOptions);
})();

*** Add File: /Users/lcolvin/Dev/outlook-zero-firefox/options.css
*,
*::before,
*::after {
  box-sizing: border-box;
}

html,
body {
  margin: 0;
  padding: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background-color: #f3f4f6;
  color: #111827;
}

body {
  min-height: 100vh;
}

.oz-container {
  max-width: 760px;
  margin: 24px auto;
  padding: 0 16px 32px;
}

.oz-header {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 24px;
}

.oz-icon-circle {
  width: 40px;
  height: 40px;
  border-radius: 999px;
  background: linear-gradient(135deg, #2563eb, #4f46e5);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 700;
  font-size: 14px;
  box-shadow: 0 8px 16px rgba(37, 99, 235, 0.35);
}

.oz-icon-letter {
  letter-spacing: 0.03em;
}

h1 {
  margin: 0 0 4px;
  font-size: 1.4rem;
}

.oz-subtitle {
  margin: 0;
  color: #4b5563;
  font-size: 0.9rem;
}

.oz-card {
  background-color: #ffffff;
  border-radius: 12px;
  padding: 16px 18px 18px;
  box-shadow:
    0 1px 2px rgba(15, 23, 42, 0.05),
    0 8px 20px rgba(15, 23, 42, 0.04);
  margin-bottom: 16px;
}

.oz-card h2 {
  margin-top: 0;
  margin-bottom: 8px;
  font-size: 1.1rem;
}

.oz-help {
  margin-top: 0;
  margin-bottom: 12px;
  font-size: 0.9rem;
  color: #4b5563;
}

.oz-shortcut-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.oz-label {
  font-size: 0.9rem;
  font-weight: 500;
  min-width: 70px;
}

.oz-shortcut-input {
  flex: 1;
  border-radius: 999px;
  border: 1px solid #d1d5db;
  padding: 8px 12px;
  font-size: 0.95rem;
  outline: none;
  background-color: #f9fafb;
}

.oz-shortcut-input:focus-visible {
  border-color: #2563eb;
  box-shadow: 0 0 0 1px #2563eb33;
  background-color: #ffffff;
}

.oz-button {
  border-radius: 999px;
  border: none;
  padding: 7px 14px;
  font-size: 0.85rem;
  cursor: pointer;
  font-weight: 500;
  transition:
    background-color 120ms ease,
    box-shadow 120ms ease,
    transform 50ms ease;
}

.oz-button-ghost {
  background-color: #f3f4f6;
  color: #374151;
}

.oz-button-ghost:hover {
  background-color: #e5e7eb;
}

.oz-button:active {
  transform: translateY(1px);
  box-shadow: none;
}

.oz-status {
  margin-top: 10px;
  font-size: 0.85rem;
  color: #059669;
  opacity: 0;
  transition: opacity 160ms ease;
}

.oz-status-visible {
  opacity: 1;
}

.oz-toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 14px;
  font-size: 0.9rem;
  color: #374151;
}

.oz-toggle-input {
  width: 16px;
  height: 16px;
}

.oz-toggle-label {
  flex: 1;
}

.oz-list {
  margin: 0;
  padding-left: 18px;
  font-size: 0.9rem;
  color: #4b5563;
}

.oz-list li + li {
  margin-top: 4px;
}

.oz-footer {
  display: flex;
  justify-content: space-between;
  margin-top: 16px;
  font-size: 0.8rem;
  color: #6b7280;
}

code,
kbd {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
    "Courier New", monospace;
  font-size: 0.85em;
}

kbd {
  padding: 2px 5px;
  border-radius: 4px;
  border: 1px solid #d1d5db;
  background-color: #f9fafb;
}

@media (max-width: 600px) {
  .oz-shortcut-row {
    flex-direction: column;
    align-items: stretch;
  }

  .oz-label {
    min-width: 0;
  }
}


